# إصلاح ميزة عرض نسبة محدودة من منشورات المتابعين

## المشكلة

كانت الميزة مطبقة بشكل جزئي:
- نظام الإشعارات يعمل بشكل صحيح عند إنشاء المحتوى (يحدد 15% من المتابعين سيرون المنشور)
- لكن endpoints جلب البيانات كانت تتجاهل نظام الإشعارات وتستخدم خوارزمية قديمة بنسبة 5%
- النتيجة: جميع المنشورات من المتابعين كانت تظهر في الصفحة الرئيسية

## الحل المطبق

تم تحديث 3 endpoints لاستخدام نظام الإشعارات:

### 1. `/api/v1/posts` (postRoutes.js)
- إضافة جلب الإشعارات مع بيانات المستخدم
- فلترة المنشورات من المتابعين بناءً على `showInFeed` في الإشعار
- عرض المنشور فقط إذا:
  - كان من غير المتابعين، أو
  - لم يوجد إشعار له (منشورات قديمة)، أو
  - `showInFeed !== false` في الإشعار

### 2. `/api/v1/shipmentads` (shipmentAdRoutes.js)
- نفس التحديث للإعلانات
- التحقق من `notif.shipmentAd` بدلاً من `notif.post`

### 3. `/api/v1/emptytruckads` (emptyTruckAdRoutes.js)
- نفس التحديث للإعلانات
- التحقق من `notif.emptyTruckAd`

## النتيجة

الآن عند نشر محتوى جديد:
1. يتم إنشاء إشعارات لجميع المتابعين
2. 15% من المتابعين يحصلون على `showInFeed: true` (يرون المحتوى في الصفحة الرئيسية)
3. 85% الباقية يحصلون على `showInFeed: false` (يرون المحتوى فقط في صفحة الإشعارات)
4. endpoints جلب البيانات تحترم هذا النظام

## ملاحظات

- تم تغيير نسبة الترتيب في `applyFeedAlgorithm` من 5% إلى 10% للحصول على توازن أفضل
- المنشورات القديمة (قبل تطبيق الميزة) ستظهر للجميع لأنها لا تحتوي على إشعارات
- الميزة تعمل مع جميع أنواع المحتوى: المنشورات، إعلانات الشحن، إعلانات الشاحنات الفارغة

## التاريخ

**2025-10-31**: إصلاح endpoints جلب البيانات لاستخدام نظام الإشعارات
