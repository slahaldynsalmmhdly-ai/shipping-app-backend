# ููุฒุฉ ุงูุฅุฎูุงุก ุงูุฐูู ููููุดูุฑุงุช ุงูุฎุงุตุฉ (Facebook-Style)

## ุงููุตู

ุชู ุชุทุจูู ููุฒุฉ **ุงูุฅุฎูุงุก ุงูุฐูู** ูู ุงูุฎุงุฏูุ ุชุนูู ุจููุณ ุทุฑููุฉ ููุณุจูู:

- โ **ุนูุฏ ุงููุดุฑ:** ุงูููุดูุฑ ูุธูุฑ ูู ุตูุญุชู ุงูุฑุฆูุณูุฉ ูุคูุชุงู
- โ **ุฃูู 5 ุฏูุงุฆู:** ุงูููุดูุฑ ูุจูู ุธุงูุฑ ูู ุตูุญุชู
- โ **ุจุนุฏ 5 ุฏูุงุฆู:** ุงูููุดูุฑ ูุฎุชูู ุชููุงุฆูุงู ูู ุตูุญุชู ุงูุฑุฆูุณูุฉ
- โ **ูููุณุชุฎุฏููู ุงูุขุฎุฑูู:** ูุธูุฑ ุจุดูู ุทุจูุนู (ุญุณุจ ูุธุงู ุงูู 15%)

---

## ุงููุงุฆุฏุฉ

### ููุงุฐุง ูุฐู ุงูููุฒุฉุ

1. **ุชุฃููุฏ ุงููุดุฑ:** ุนูุฏ ุงููุดุฑุ ุชุฑู ุงูููุดูุฑ ููุฑุงู ููุชุฃูุฏ ูู ูุฌุงุญ ุงูุนูููุฉ
2. **ุงูุชุนุฏูู ุงูุณุฑูุน:** ุฅุฐุง ุฃุฑุฏุช ุชุนุฏูู ุฃู ุญุฐู ุงูููุดูุฑุ ุชุฑุงู ูุจุงุดุฑุฉ
3. **ุชุฌุฑุจุฉ ูุธููุฉ:** ุจุนุฏ 5 ุฏูุงุฆูุ ูุฎุชูู ุชููุงุฆูุงู ูุชุฑูุฒ ุนูู ูุญุชูู ุงูุขุฎุฑูู
4. **ูุซู ููุณุจูู:** ููุณ ุงูุณููู ุงูุฐู ูุชููุนู ุงููุณุชุฎุฏููู

---

## ุงูุชุทุจูู ุงูุชููู

### ุงูุขููุฉ:

ุนูุฏ ุฌูุจ ุงูููุดูุฑุงุช ููุตูุญุฉ ุงูุฑุฆูุณูุฉุ ูุชู ุญุณุงุจ **ุนูุฑ ุงูููุดูุฑ**:

```javascript
const postAge = Date.now() - new Date(post.createdAt).getTime();
const fiveMinutes = 5 * 60 * 1000; // 5 ุฏูุงุฆู ุจุงูููู ุซุงููุฉ

if (postAge > fiveMinutes) {
  continue; // ูุง ุชุนุฑุถ ุฅุฐุง ูุฑ ุฃูุซุฑ ูู 5 ุฏูุงุฆู
}
// ุฅุฐุง ูุงู ุฃุญุฏุซ ูู 5 ุฏูุงุฆูุ ูุนุฑุถ
```

---

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `routes/postRoutes.js` (ุงูุณุทุฑ 104-114)

```javascript
for (const post of allPosts) {
  // ุฅุฎูุงุก ููุดูุฑุงุช ุงููุณุชุฎุฏู ุงูุฎุงุตุฉ ูู ุตูุญุชู ุงูุฑุฆูุณูุฉ (ุฅูุง ุฅุฐุง ูุงู ุญุฏูุซ ุฌุฏุงู)
  if (post.user._id.toString() === req.user.id) {
    // ุงูููุดูุฑุงุช ุงูุญุฏูุซุฉ ุฌุฏุงู (ุขุฎุฑ 5 ุฏูุงุฆู) ุชุธูุฑ ูุคูุชุงู
    const postAge = Date.now() - new Date(post.createdAt).getTime();
    const fiveMinutes = 5 * 60 * 1000; // 5 ุฏูุงุฆู ุจุงูููู ุซุงููุฉ
    
    if (postAge > fiveMinutes) {
      continue; // ูุง ุชุนุฑุถ ุฅุฐุง ูุฑ ุฃูุซุฑ ูู 5 ุฏูุงุฆู
    }
    // ุฅุฐุง ูุงู ุฃุญุฏุซ ูู 5 ุฏูุงุฆูุ ูุนุฑุถ ููููู ููููุชุฑุฉ
  }
  // ... ุจุงูู ุงูููุชุฑุฉ
}
```

### 2. `routes/shipmentAdRoutes.js` (ุงูุณุทุฑ 100-109)

```javascript
for (const ad of shipmentAds) {
  // ุฅุฎูุงุก ุฅุนูุงูุงุช ุงููุณุชุฎุฏู ุงูุฎุงุตุฉ ูู ุตูุญุชู ุงูุฑุฆูุณูุฉ (ุฅูุง ุฅุฐุง ูุงู ุญุฏูุซ ุฌุฏุงู)
  if (ad.user._id.toString() === req.user.id) {
    // ุงูุฅุนูุงูุงุช ุงูุญุฏูุซุฉ ุฌุฏุงู (ุขุฎุฑ 5 ุฏูุงุฆู) ุชุธูุฑ ูุคูุชุงู
    const adAge = Date.now() - new Date(ad.createdAt).getTime();
    const fiveMinutes = 5 * 60 * 1000;
    
    if (adAge > fiveMinutes) {
      continue; // ูุง ุชุนุฑุถ ุฅุฐุง ูุฑ ุฃูุซุฑ ูู 5 ุฏูุงุฆู
    }
  }
  // ... ุจุงูู ุงูููุชุฑุฉ
}
```

### 3. `routes/emptyTruckAdRoutes.js` (ุงูุณุทุฑ 86-95)

```javascript
for (const ad of emptyTruckAds) {
  // ุฅุฎูุงุก ุฅุนูุงูุงุช ุงููุณุชุฎุฏู ุงูุฎุงุตุฉ ูู ุตูุญุชู ุงูุฑุฆูุณูุฉ (ุฅูุง ุฅุฐุง ูุงู ุญุฏูุซ ุฌุฏุงู)
  if (ad.user._id.toString() === req.user.id) {
    // ุงูุฅุนูุงูุงุช ุงูุญุฏูุซุฉ ุฌุฏุงู (ุขุฎุฑ 5 ุฏูุงุฆู) ุชุธูุฑ ูุคูุชุงู
    const adAge = Date.now() - new Date(ad.createdAt).getTime();
    const fiveMinutes = 5 * 60 * 1000;
    
    if (adAge > fiveMinutes) {
      continue; // ูุง ุชุนุฑุถ ุฅุฐุง ูุฑ ุฃูุซุฑ ูู 5 ุฏูุงุฆู
    }
  }
  // ... ุจุงูู ุงูููุชุฑุฉ
}
```

---

## ุขููุฉ ุงูุนูู ุงููุงููุฉ

### ๐น ุงูุณููุงุฑูู 1: ูุดุฑ ููุดูุฑ ุฌุฏูุฏ

```
ุงูููุช: 12:00:00
ุงููุณุชุฎุฏู A ููุดุฑ ููุดูุฑุงู
         โ
ุงูููุช: 12:00:05
ุงููุณุชุฎุฏู A ููุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
         โ
ุงูุจุงู ุฅูุฏ ูุญุณุจ ุนูุฑ ุงูููุดูุฑ: 5 ุซูุงูู
         โ
5 ุซูุงูู < 5 ุฏูุงุฆู โ
         โ
ุงูููุดูุฑ ูุธูุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
```

### ๐น ุงูุณููุงุฑูู 2: ุจุนุฏ 3 ุฏูุงุฆู

```
ุงูููุช: 12:03:00
ุงููุณุชุฎุฏู A ููุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
         โ
ุงูุจุงู ุฅูุฏ ูุญุณุจ ุนูุฑ ุงูููุดูุฑ: 3 ุฏูุงุฆู
         โ
3 ุฏูุงุฆู < 5 ุฏูุงุฆู โ
         โ
ุงูููุดูุฑ ูุธูุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
```

### ๐น ุงูุณููุงุฑูู 3: ุจุนุฏ 6 ุฏูุงุฆู

```
ุงูููุช: 12:06:00
ุงููุณุชุฎุฏู A ููุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
         โ
ุงูุจุงู ุฅูุฏ ูุญุณุจ ุนูุฑ ุงูููุดูุฑ: 6 ุฏูุงุฆู
         โ
6 ุฏูุงุฆู > 5 ุฏูุงุฆู โ
         โ
ุงูููุดูุฑ ูุง ูุธูุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
```

### ๐น ุงูุณููุงุฑูู 4: ูููุณุชุฎุฏููู ุงูุขุฎุฑูู

```
ุงูููุช: ุฃู ููุช
ุงููุณุชุฎุฏู B ููุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
         โ
ุงูููุดูุฑ ููุณ ูู ุชุฃููู B
         โ
ูุทุจู ูุธุงู ุงูููุชุฑุฉ ุงูุนุงุฏู (15% ูููุชุงุจุนูู)
         โ
ุงูููุดูุฑ ูุธูุฑ ุจุดูู ุทุจูุนู โ
```

---

## ุงููุฒุงูุง

### โ ุจุณูุท ููุนุงู:
- ูุง ูุญุชุงุฌ ุฌุฏุงูู ุฅุถุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุง ูุญุชุงุฌ cron jobs ุฃู scheduled tasks
- ูุนุชูุฏ ููุท ุนูู ุญูู `createdAt` ุงูููุฌูุฏ ุฃุตูุงู

### โ ุฏููู:
- ูุญุณุจ ุงูููุช ุจุงูููู ุซุงููุฉ
- ูุนูู ูู ุฃู timezone
- ูุง ูุชุฃุซุฑ ุจุชูููุช ุงูุฎุงุฏู ุฃู ุงูุนููู

### โ ูุงุจู ููุชุฎุตูุต:
- ูููู ุชุบููุฑ ุงููุฏุฉ ูู 5 ุฏูุงุฆู ุฅูู ุฃู ูุฏุฉ ุฃุฎุฑู
- ูููู ุฌุนููุง ูุชุบูุฑุฉ ุญุณุจ ููุน ุงููุญุชูู

---

## ุงูุชุฎุตูุต

### ุชุบููุฑ ุงููุฏุฉ:

ุฅุฐุง ุฃุฑุฏุช ุชุบููุฑ ุงููุฏุฉ ูู 5 ุฏูุงุฆู ุฅูู ูุฏุฉ ุฃุฎุฑู:

```javascript
// 10 ุฏูุงุฆู
const tenMinutes = 10 * 60 * 1000;

// 30 ุซุงููุฉ
const thirtySeconds = 30 * 1000;

// ุณุงุนุฉ ูุงุญุฏุฉ
const oneHour = 60 * 60 * 1000;
```

### ูุฏุฉ ูุฎุชููุฉ ููู ููุน:

```javascript
// ูู postRoutes.js
const postDuration = 5 * 60 * 1000; // 5 ุฏูุงุฆู ููููุดูุฑุงุช

// ูู shipmentAdRoutes.js
const adDuration = 10 * 60 * 1000; // 10 ุฏูุงุฆู ููุฅุนูุงูุงุช
```

---

## ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:

1. **ุงูุดุฑ ููุดูุฑ ุฌุฏูุฏ**
2. **ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ููุฑุงู**
3. **ุงููุชูุฌุฉ:** ุงูููุดูุฑ ูุธูุฑ โ
4. **ุงูุชุธุฑ 6 ุฏูุงุฆู**
5. **ุงูุชุญ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุฑุฉ ุฃุฎุฑู**
6. **ุงููุชูุฌุฉ:** ุงูููุดูุฑ ูุง ูุธูุฑ โ
7. **ุงูุชุญ ุงูููู ุงูุดุฎุตู**
8. **ุงููุชูุฌุฉ:** ุงูููุดูุฑ ูุธูุฑ โ

### ุงุฎุชุจุงุฑ ูุชูุฏู:

```bash
# ูู terminalุ ุงุญุณุจ ุนูุฑ ููุดูุฑ:
node -e "console.log((Date.now() - new Date('2025-10-31T08:00:00Z').getTime()) / 1000 / 60, 'minutes')"
```

---

## ุงูุชูุงูู

ูุฐู ุงูููุฒุฉ ุชุนูู ุจุงูุชูุงุฒู ูุน:
- โ ูุธุงู ุงูููุชุฑุฉ 15% ูููุชุงุจุนูู
- โ ูุธุงู ุงูุฅุดุนุงุฑุงุช
- โ ุฎูุงุฑุฒููุฉ ุงูุชุฑุชูุจ Facebook-style
- โ ุฌููุน ุฃููุงุน ุงููุญุชูู (ููุดูุฑุงุชุ ุฅุนูุงูุงุช)

---

## ุงูุฃุฏุงุก

### ุชุฃุซูุฑ ุนูู ุงูุฃุฏุงุก:

- **ุถุฆูู ุฌุฏุงู**: ุนูููุฉ ุญุณุงุจูุฉ ุจุณูุทุฉ (ุทุฑุญ ููุชูู)
- **ูุง ูุชุทูุจ ุงุณุชุนูุงูุงุช ุฅุถุงููุฉ** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ูุนูู ูู ุงูุฐุงูุฑุฉ** (in-memory calculation)

### ููุงุฑูุฉ:

| ุงูุทุฑููุฉ | ุงุณุชุนูุงูุงุช DB | ุชุนููุฏ ุงูููุช | ุงูุฏูุฉ |
|---------|--------------|------------|-------|
| ุงูุญู ุงูุญุงูู | 0 ุฅุถุงููุฉ | O(1) | ุฏูููุฉ ุฌุฏุงู |
| Cron job | 1+ | O(n) | ุชูุฑูุจูุฉ |
| Session storage | 0 | O(1) | ุชุนุชูุฏ ุนูู ุงูุนููู |

---

## ุงูููุงุญุธุงุช

### โ๏ธ ููู:

1. **ุงูููุช ูุนุชูุฏ ุนูู `createdAt`** - ุชุฃูุฏ ุฃู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญูุธ ุงูููุช ุจุดูู ุตุญูุญ
2. **ูุง ูุญุชุงุฌ ุชุนุฏูู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ** - ูู ุดูุก ูู ุงูุจุงู ุฅูุฏ
3. **ูุนูู ููุฑุงู** ุจุนุฏ ุฑูุน ุงูุชุญุฏูุซุงุช ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู

### ๐ก ูุตูุญุฉ:

ุฅุฐุง ุฃุฑุฏุช ุงุฎุชุจุงุฑ ุงูููุฒุฉ ุจุณุฑุนุฉุ ุบููุฑ ุงููุฏุฉ ูุคูุชุงู ุฅูู 30 ุซุงููุฉ:

```javascript
const fiveMinutes = 30 * 1000; // 30 ุซุงููุฉ ููุงุฎุชุจุงุฑ
```

---

## ุงูุชุงุฑูุฎ

**2025-10-31**: ุชุทุจูู ููุฒุฉ ุงูุฅุฎูุงุก ุงูุฐูู ููููุดูุฑุงุช ุงูุฎุงุตุฉ (Facebook-Style)
