# ุชูุซูู ููุฒุฉ ูุญูู/ุนุงููู ูู ุงูููุดูุฑุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ุฌุฏูุฏุฉ ูุชุตููุฉ ุงูููุดูุฑุงุช ุญุณุจ ุงููุทุงู ุงูุฌุบุฑุงูู:
- **ูุญูู (Local)**: ุนุฑุถ ููุดูุฑุงุช ูู ููุณ ุฏููุฉ ุงููุณุชุฎุฏู ููุท
- **ุนุงููู (Global)**: ุนุฑุถ ููุดูุฑุงุช ูู ุฌููุน ุงูุฏูู

---

## โ ุงูุชุญุฏูุซุงุช ุงููููุฐุฉ ุนูู ุงูุฎุงุฏู

### 1. ุชุญุฏูุซ ูุณุงุฑ Feed

**ุงูููู:** `routes/feedRoutes.js`

**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ parameter `scope` (local ุฃู global)
- โ ุญุฐู ุงูุฎูุงุฑุฒููุฉ ุงููุนูุฏุฉ (ุงูุชูุงุนูุงุชุ ุงูููุงุทุ ุงูุชุตูููุงุช)
- โ ุงุณุชุจุฏุงููุง ุจุฎูุงุฑุฒููุฉ ุจุณูุทุฉ: ุชุฑุชูุจ ุญุณุจ ุงูููุช (ุงูุฃุญุฏุซ ุฃููุงู)
- โ ููุชุฑุฉ ุงูููุดูุฑุงุช ุญุณุจ ุฏููุฉ ุงููุณุชุฎุฏู ูู ุงููุถุน ุงููุญูู

### 2. ููููุฉ ุงูุงุณุชุฎุฏุงู

**ุงูุทูุจ:**
```http
GET /api/v1/feed?scope=local&page=1&limit=10
GET /api/v1/feed?scope=global&page=1&limit=10
```

**Parameters:**
- `scope` (ุงุฎุชูุงุฑู): `local` ุฃู `global` (ุงูุงูุชุฑุงุถู: `global`)
- `page` (ุงุฎุชูุงุฑู): ุฑูู ุงูุตูุญุฉ (ุงูุงูุชุฑุงุถู: 1)
- `limit` (ุงุฎุชูุงุฑู): ุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงูุตูุญุฉ (ุงูุงูุชุฑุงุถู: 10)

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "items": [
    {
      "_id": "...",
      "text": "ูุญุชูู ุงูููุดูุฑ",
      "user": {
        "_id": "...",
        "name": "ุงุณู ุงููุณุชุฎุฏู",
        "country": "Saudi Arabia"
      },
      "itemType": "post",
      "createdAt": "2025-11-03T00:00:00.000Z"
    }
  ],
  "pagination": {
    "currentPage": 1,
    "itemsPerPage": 10,
    "hasMore": true,
    "scope": "local"
  }
}
```

---

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ

### ุงูุฎูุงุฑุฒููุฉ ุงูุฌุฏูุฏุฉ

**ูุจู ุงูุชุญุฏูุซ:**
- ุฎูุงุฑุฒููุฉ ูุนูุฏุฉ ูุน ููุงุท ุงูุชูุงุนู
- ุชุตููู ุงููุญุชูู (ูุตุตุ ุฃุฎุจุงุฑุ ุนุงู)
- ููุชุฑุฉ ุญุณุจ ุงูุชูุงุนูุงุช
- ูุฑุงูุจุฉ ุชูุถููุงุช ุงููุณุชุฎุฏู
- **ุงููุชูุฌุฉ:** ุจุทูุก ููุนูุฏ

**ุจุนุฏ ุงูุชุญุฏูุซ:**
- ุชุฑุชูุจ ุจุณูุท ุญุณุจ `createdAt` (ุงูุฃุญุฏุซ ุฃููุงู)
- ููุชุฑุฉ ุญุณุจ ุงูุฏููุฉ (ูู ุงููุถุน ุงููุญูู)
- **ุงููุชูุฌุฉ:** ุณุฑูุน ูุจุณูุท

### ุงูููุฏ ุงูุฑุฆูุณู

```javascript
// ุจูุงุก ููุชุฑ ุงูุฏููุฉ
let countryFilter = {};
if (scope === 'local' && userCountry) {
  countryFilter = { country: userCountry };
}

// ุฌูุจ ุงูููุดูุฑุงุช ูุน ุงูููุชุฑุฉ
const posts = await Post.find({
  $or: [{ isPublished: true }, { isPublished: { $exists: false } }],
  hiddenFromHomeFeedFor: { $ne: req.user.id },
  user: { $ne: req.user.id }
})
  .populate({
    path: 'user',
    select: 'name avatar userType companyName country',
    match: countryFilter // ููุชุฑุฉ ุญุณุจ ุงูุฏููุฉ
  })
  .sort({ createdAt: -1 }) // ุงูุฃุญุฏุซ ุฃููุงู
  .limit(limit)
  .lean();

// ููุชุฑุฉ ุงูุนูุงุตุฑ ุงูุชู ูุฏููุง user (ุจุนุฏ populate)
const validPosts = posts.filter(p => p.user !== null);
```

---

## ๐ ููุงุฑูุฉ ุงูุฃุฏุงุก

| **ุงููููุงุณ** | **ูุจู ุงูุชุญุฏูุซ** | **ุจุนุฏ ุงูุชุญุฏูุซ** |
|---|---|---|
| ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช | 10+ | 3 |
| ุงูููุช ุงููุณุชุบุฑู | 5-10 ุซูุงูู | 1-2 ุซุงููุฉ |
| ุชุนููุฏ ุงูููุฏ | 600+ ุณุทุฑ | 200 ุณุทุฑ |
| ุงุณุชููุงู ุงูุฐุงูุฑุฉ | ุนุงูู | ููุฎูุถ |

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงููุถุน ุงูุนุงููู

```bash
curl -X GET "http://localhost:5000/api/v1/feed?scope=global&page=1&limit=5" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ููุดูุฑุงุช ูู ุฌููุน ุงูุฏูู

### ุงุฎุชุจุงุฑ ุงููุถุน ุงููุญูู

```bash
curl -X GET "http://localhost:5000/api/v1/feed?scope=local&page=1&limit=5" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ููุดูุฑุงุช ูู ููุณ ุฏููุฉ ุงููุณุชุฎุฏู ููุท

### ุงุฎุชุจุงุฑ ุจุฏูู scope

```bash
curl -X GET "http://localhost:5000/api/v1/feed?page=1&limit=5" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ููุดูุฑุงุช ูู ุฌููุน ุงูุฏูู (ุงูุงูุชุฑุงุถู: global)

---

## ๐จ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### ุงูุญุงูุฉ ุงูุญุงููุฉ

ุงููุงุฌูุฉ ุงูุฃูุงููุฉ **ูุง ุชุญุชูู** ุนูู ุฒุฑ ุงูุชุจุฏูู ุจูู ูุญูู/ุนุงููู ุญุงููุงู.

### ุงููุทููุจ

ุฅุถุงูุฉ ุฒุฑ ุชุจุฏูู ูู `HomeScreen.tsx`:

```tsx
const [feedScope, setFeedScope] = useState<'local' | 'global'>('global');

// ูู JSX
<div className="feed-scope-toggle">
  <button 
    className={feedScope === 'local' ? 'active' : ''} 
    onClick={() => setFeedScope('local')}
  >
    ๐ ูุญูู
  </button>
  <button 
    className={feedScope === 'global' ? 'active' : ''} 
    onClick={() => setFeedScope('global')}
  >
    ๐ ุนุงููู
  </button>
</div>

// ุชุญุฏูุซ ุงุณุชุฏุนุงุก API
const res = await fetch(
  `${API_BASE_URL}/api/v1/feed?page=1&limit=3&scope=${feedScope}`,
  { headers }
);
```

**ููุชูุงุตูู ุงููุงููุฉ:** ุฑุงุฌุน ููู `LOCAL_GLOBAL_FEATURE_PROMPT.md`

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุงููุณุชุฎุฏููู ุจุฏูู ุฏููุฉ

ุฅุฐุง ูู ููู ูุฏู ุงููุณุชุฎุฏู ุญูู `country`:
- ูู ุงููุถุน ุงููุญูู: ูู ูุธูุฑ ุฃู ููุดูุฑุงุช
- ูู ุงููุถุน ุงูุนุงููู: ูุนูู ุจุดูู ุทุจูุนู

**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ุฌููุน ุงููุณุชุฎุฏููู ูุฏููู ุญูู `country` (ุชู ุฌุนูู ุฅูุฒุงููุงู ูู ุงูุชุญุฏูุซ ุงูุณุงุจู)

### 2. ุงูุฃุฏุงุก

ุงูุฎูุงุฑุฒููุฉ ุงูุฌุฏูุฏุฉ **ุฃุณุฑุน ุจูุซูุฑ** ูุฃููุง:
- ูุง ุชุญุณุจ ููุงุท ุงูุชูุงุนู
- ูุง ุชุตูู ุงููุญุชูู
- ูุง ุชุฑุงูุจ ุชูุถููุงุช ุงููุณุชุฎุฏู
- ููุท ุชุฑุชูุจ ุจุณูุท ุญุณุจ ุงูููุช

### 3. ุงูุชูุงูู

ุงูููุฒุฉ **ูุชูุงููุฉ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุณุงุจูุฉ**:
- ุฅุฐุง ูู ูุชู ุฅุฑุณุงู `scope`ุ ุงูุงูุชุฑุงุถู ูู `global`
- ุงูุชุทุจููุงุช ุงููุฏููุฉ ุณุชุนูู ุจุฏูู ุชุญุฏูุซ

---

## ๐ ุฎุทูุงุช ุงููุดุฑ

### 1. ุงูุชุฃูุฏ ูู ุงูุชุญุฏูุซุงุช

```bash
cd /home/ubuntu/shipping-app-backend
git pull origin main
```

### 2. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู

```bash
npm start
# ุฃู
pm2 restart app-name
```

### 3. ุงุฎุชุจุงุฑ ุงูููุฒุฉ

```bash
# ุงุฎุชุจุงุฑ ูุญูู
curl -X GET "http://your-server/api/v1/feed?scope=local" \
  -H "Authorization: Bearer TOKEN"

# ุงุฎุชุจุงุฑ ุนุงููู
curl -X GET "http://your-server/api/v1/feed?scope=global" \
  -H "Authorization: Bearer TOKEN"
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ููุดูุฑุงุช ูู ุงููุถุน ุงููุญูู

**ุงูุณุจุจ ุงููุญุชูู:**
- ุงููุณุชุฎุฏู ููุณ ูุฏูู ุญูู `country`
- ูุง ุชูุฌุฏ ููุดูุฑุงุช ูู ููุณ ุงูุฏููุฉ

**ุงูุญู:**
```javascript
// ุชุญูู ูู ุฏููุฉ ุงููุณุชุฎุฏู
const user = await User.findById(userId);
console.log('User country:', user.country);

// ุชุญูู ูู ุนุฏุฏ ุงูููุดูุฑุงุช ูู ููุณ ุงูุฏููุฉ
const count = await Post.countDocuments({})
  .populate({
    path: 'user',
    match: { country: user.country }
  });
console.log('Posts in same country:', count);
```

### ุงููุดููุฉ: ุงูุฎุงุฏู ุจุทูุก

**ุงูุณุจุจ ุงููุญุชูู:**
- ุงูููุฑุณุฉ (Indexing) ุบูุฑ ููุฌูุฏุฉ

**ุงูุญู:**
```javascript
// ุฃุถู ููุฑุณุฉ ุนูู ุญูู country
db.users.createIndex({ country: 1 });
db.posts.createIndex({ createdAt: -1 });
```

---

## ๐ ุงููุฑุงุฌุน

- **ููู ุงููุณุงุฑ:** `routes/feedRoutes.js`
- **ูููุฐุฌ ุงููุณุชุฎุฏู:** `models/User.js`
- **ูููุฐุฌ ุงูููุดูุฑ:** `models/Post.js`
- **ุงููุทุงูุจุฉ ูููุงุฌูุฉ ุงูุฃูุงููุฉ:** `LOCAL_GLOBAL_FEATURE_PROMPT.md`

---

## ๐ฏ ุงูุฎูุงุตุฉ

โ ุชู ุฅุถุงูุฉ ููุฒุฉ ูุญูู/ุนุงููู ุจูุฌุงุญ  
โ ุชู ุชุจุณูุท ุงูุฎูุงุฑุฒููุฉ (ุงูุฃุญุฏุซ ุฃููุงู)  
โ ุชู ุชุญุณูู ุงูุฃุฏุงุก ุจุดูู ูุจูุฑ  
โ ุงูุฎุงุฏู ุฌุงูุฒ ูุงูููุฒุฉ ุชุนูู  
โณ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ุชุญุชุงุฌ ุชุญุฏูุซ (ุฑุงุฌุน ุงููุทุงูุจุฉ)  

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:** ุชุญุฏูุซ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุฅุถุงูุฉ ุฒุฑ ุงูุชุจุฏูู

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 3 ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ:** 2.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
