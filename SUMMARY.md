# ููุฎุต ุงูุชุญุฏูุซุงุช - ูุธุงู Feed ุงููุญุณูู

## โ ุชู ุจูุฌุงุญ

ุชู ุชุทููุฑ ูุฑูุน ูุธุงู Feed ุฌุฏูุฏ ููุญุณูู ุฅูู ุงููุณุชูุฏุน ุจูุฌุงุญ!

## ๐ฏ ุงููุดุงูู ุงูุชู ุชู ุญููุง

### 1. ูุดููุฉ ุงูุงุฑุชุจุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ โ
**ุงููุดููุฉ ุงูุณุงุจูุฉ**: ุนูุฏ ุงุณุชุฎุฏุงู ุงูุฎูุท ุงูุนุดูุงุฆูุ ูุงูุช ุงูููุดูุฑุงุช ุชุธูุฑ ุซู ุชุฎุชูู ุซู ุชุธูุฑ ููุดูุฑุงุช ุฌุฏูุฏุฉ.

**ุงูุญู ุงููุทุจู**: ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุฉ ุฎูุท ุซุงุจุชุฉ (seeded random) ุชุนุชูุฏ ุนูู ูุนุฑู ุงููุณุชุฎุฏูุ ููุง ูุถูู ููุณ ุงูุชุฑุชูุจ ุนูุฏ ูู ุชุญุฏูุซ.

### 2. ูุดููุฉ ุธููุฑ ุฌููุน ููุดูุฑุงุช ุงููุชุงุจูุนูู โ
**ุงููุดููุฉ ุงูุณุงุจูุฉ**: ุนูุฏ ุงูุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎุ ูุงูุช ุฌููุน ููุดูุฑุงุช ุงููุชุงุจูุนูู ุชุธูุฑ ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ.

**ุงูุญู ุงููุทุจู**: ุชุทุจูู ูุณุจุฉ **15% ููุท** ูููุดูุฑุงุช ุงููุชุงุจูุนูู ูุน **85%** ูููุดูุฑุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู.

### 3. ุนุฏู ุฏูุฌ ุงูุฅุนูุงูุงุช โ
**ุงููุดููุฉ ุงูุณุงุจูุฉ**: ูุงูุช ุงูููุดูุฑุงุช ููุท ุชุธูุฑุ ุจุฏูู ุฅุนูุงูุงุช ุงูุดุญู ุฃู ุงูุดุงุญูุงุช ุงููุงุฑุบุฉ.

**ุงูุญู ุงููุทุจู**: ุฅูุดุงุก endpoint ุฌุฏูุฏ ูุฏูุฌ:
- ุงูููุดูุฑุงุช (Posts)
- ุฅุนูุงูุงุช ุงูุดุญู (ShipmentAds)
- ุฅุนูุงูุงุช ุงูุดุงุญูุงุช ุงููุงุฑุบุฉ (EmptyTruckAds)

## ๐ฆ ุงููููุงุช ุงููุถุงูุฉ

### 1. `routes/feedRoutes.js`
ุงูููู ุงูุฑุฆูุณู ุงูุฐู ูุญุชูู ุนูู:
- **Endpoint**: `GET /api/v1/feed` - ููุญุตูู ุนูู Feed ููุญุฏ
- **Endpoint**: `GET /api/v1/feed/stats` - ููุฅุญุตุงุฆูุงุช
- ุฎูุงุฑุฒููุฉ ุงูุชุณุฌูู ุงูุฐููุฉ
- ุฎูุงุฑุฒููุฉ ุงูุฎูุท ุงูุซุงุจุช
- ุฏุนู Pagination

### 2. `ANALYSIS.md`
ุชุญููู ุชูุตููู ูููุดููุฉ ูุงูุญู ุงูููุชุฑุญ

### 3. `FEED_UPDATE_DOCUMENTATION.md`
ุชูุซูู ูุงูู ูุดุงูู ููุชุญุฏูุซุงุช ูุดูู:
- ุดุฑุญ ุงููุดุงูู ูุงูุญููู
- ุชูุงุตูู ุงูุฎูุงุฑุฒููุงุช
- ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู
- ูุตุงุฆุญ ููุชูุงูู

### 4. `FEED_UPDATE_README.md`
ุฏููู ุณุฑูุน ููุงุณุชุฎุฏุงู ูุดูู:
- ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ
- ุฃูุซูุฉ ุนูู ุงูููุฏ
- ุงุณุชูุดุงู ุงูุฃุฎุทุงุก
- ุงูุชูุตูุงุช

## ๐ง ุงูุชุนุฏููุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

### `server.js`
ุชู ุฅุถุงูุฉ ุณุทุฑูู ููุท:
```javascript
const feedRoutes = require("./routes/feedRoutes");
app.use("/api/v1/feed", feedRoutes);
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend)

ุงุณุชุจุฏู ุงูุงุณุชุฏุนุงุก ุงููุฏูู:
```javascript
// ุงููุฏูู โ
const posts = await fetch('/api/v1/posts');
```

ุจุงูุงุณุชุฏุนุงุก ุงูุฌุฏูุฏ:
```javascript
// ุงูุฌุฏูุฏ โ
const feed = await fetch('/api/v1/feed?page=1&limit=20');
```

### ูููู ุงูุงุณุชุฌุงุจุฉ
```json
{
  "items": [
    {
      "_id": "...",
      "itemType": "post",          // ุฃู "shipmentAd" ุฃู "emptyTruckAd"
      "user": { ... },
      "text": "...",
      "createdAt": "..."
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalItems": 45,
    "totalPages": 3,
    "itemsPerPage": 20,
    "hasMore": true
  }
}
```

## ๐จ ุงูุฎูุงุฑุฒููุฉ ุงูุฐููุฉ

### ูุธุงู ุงูููุงุท
ูู ููุดูุฑ/ุฅุนูุงู ูุญุตู ุนูู ููุงุท ุจูุงุกู ุนูู:

1. **ุงูููุช (30%)**
   - ุงูููุดูุฑุงุช ุงูุฃุญุฏุซ ุชุญุตู ุนูู ููุงุท ุฃุนูู
   - ุฃูู ูู 24 ุณุงุนุฉ: 100-52 ููุทุฉ
   - 24-72 ุณุงุนุฉ: 50-26 ููุทุฉ
   - 72-168 ุณุงุนุฉ: 25-15 ููุทุฉ
   - ุฃูุซุฑ ูู ุฃุณุจูุน: 15-1 ููุทุฉ

2. **ุงูุชูุงุนู (40%)**
   - ุนุฏุฏ ุงูุฅุนุฌุงุจุงุช ร 2
   - ุนุฏุฏ ุงูุชุนูููุงุช ร 3

3. **ุงูุนูุงูุฉ (30%)**
   - ุฅุฐุง ูุงู ูู ุงููุชุงุจูุนูู: +30 ููุทุฉ
   - ุฅุฐุง ูู ููู ูู ุงููุชุงุจูุนูู: 0 ููุทุฉ

### ุงููุณุจ ุงููุทุจูุฉ
- **15%** ูู ููุดูุฑุงุช ุงููุชุงุจูุนูู
- **85%** ูู ููุดูุฑุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู

### ุงูุฎูุท ุงูุซุงุจุช
- ูุณุชุฎุฏู ูุนุฑู ุงููุณุชุฎุฏู ูู seed
- ููุณ ุงููุณุชุฎุฏู ูุฑู ููุณ ุงูุชุฑุชูุจ ุนูุฏ ุงูุชุญุฏูุซ
- ูุณุชุฎุฏููู ูุฎุชูููู ูุฑูู ุชุฑุชูุจุงุช ูุฎุชููุฉ
- **ูุง ููุฌุฏ ุงุฑุชุจุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ**

## ๐ ุงูุฅุญุตุงุฆูุงุช

ููุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ุงูู Feed:
```javascript
GET /api/v1/feed/stats
```

ูุนุฑุถ:
- ุนุฏุฏ ุงูููุดูุฑุงุช
- ุนุฏุฏ ุฅุนูุงูุงุช ุงูุดุญู
- ุนุฏุฏ ุฅุนูุงูุงุช ุงูุดุงุญูุงุช ุงููุงุฑุบุฉ
- ุนุฏุฏ ุงููุชุงุจูุนูู

## ๐ ุฑุงุจุท ุงููุณุชูุฏุน

ุชู ุฑูุน ุงูุชุญุฏูุซุงุช ุจูุฌุงุญ ุฅูู:
```
https://github.com/slahaldynsalmmhdly-ai/shipping-app-backend
```

### Commit Hash
```
e56cf2c
```

### Commit Message
```
feat: Add Facebook-style unified feed with smart algorithm

- Add new /api/v1/feed endpoint that merges Posts, ShipmentAds, and EmptyTruckAds
- Implement intelligent scoring algorithm based on time (30%), engagement (40%), and relationship (30%)
- Apply 15% following ratio to reduce followed users' posts in home feed
- Use seeded random shuffle to prevent UI flickering on refresh
- Add pagination support with proper metadata
- Include /api/v1/feed/stats endpoint for debugging
- Add comprehensive documentation in Arabic
```

## โจ ุงููุฒุงูุง ุงูุฑุฆูุณูุฉ

1. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ**
   - ูุง ููุฌุฏ ุงุฑุชุจุงู ุนูุฏ ุงูุชุญุฏูุซ
   - ูุญุชูู ูุชููุน ููุชูุงุฒู
   - ุชุฑุชูุจ ุซุงุจุช ูุณูุณ

2. **ุฎูุงุฑุฒููุฉ ุฐููุฉ**
   - ุชุนุทู ุงูุฃููููุฉ ูููุญุชูู ุงูุญุฏูุซ
   - ุชุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุงูุชูุงุนูุงุช
   - ุชูุงุฒู ุจูู ุงููุชุงุจูุนูู ูุบูุฑ ุงููุชุงุจูุนูู

3. **ุฃุฏุงุก ูุญุณูู**
   - ุงุณุชุฎุฏุงู `.lean()` ูุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ
   - Pagination ูุนุงู
   - ุงุณุชุนูุงูุงุช ูุญุณููุฉ

4. **ุณูููุฉ ุงูุชูุงูู**
   - API ุจุณูุท ููุงุถุญ
   - ุชูุซูู ุดุงูู
   - ุฃูุซูุฉ ุนูููุฉ

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูู endpoints ุงููุฏููุฉ ูุง ุฒุงูุช ุชุนูู** - ูู ูุชู ุญุฐููุง ููุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ
2. **ูููุตุญ ุจุดุฏุฉ** ุจุงุณุชุฎุฏุงู `/api/v1/feed` ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
3. **ุงููุณุจ ูุงุจูุฉ ููุชุนุฏูู** ูู ููู `feedRoutes.js`
4. **ุงูุฎูุงุฑุฒููุฉ ูุงุจูุฉ ููุชุญุณูู** ุจูุงุกู ุนูู ุงูุชุญูููุงุช ุงููุณุชูุจููุฉ

## ๐ ุงูุชูุซูู

ูููุฒูุฏ ูู ุงูุชูุงุตููุ ุฑุงุฌุน:
- **`FEED_UPDATE_README.md`** - ุฏููู ุณุฑูุน ููุงุณุชุฎุฏุงู
- **`FEED_UPDATE_DOCUMENTATION.md`** - ุชูุซูู ูุงูู ูุดุงูู
- **`ANALYSIS.md`** - ุชุญููู ุงููุดููุฉ ูุงูุญู

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุชู ุญู ุฌููุน ุงููุดุงูู ุจูุฌุงุญ:
- โ ูุง ููุฌุฏ ุงุฑุชุจุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
- โ ูุณุจุฉ 15% ููุท ูู ููุดูุฑุงุช ุงููุชุงุจูุนูู
- โ ูุญุชูู ูุชููุน ูู ููุดูุฑุงุช ูุฅุนูุงูุงุช
- โ ุฎูุงุฑุฒููุฉ ุฐููุฉ ูุดุงุจูุฉ ูููุณุจูู
- โ ุฃุฏุงุก ูุญุณูู ูุน pagination
- โ ุชูุซูู ุดุงูู ุจุงูุนุฑุจูุฉ
- โ ุชู ุฑูุน ุงูุชุญุฏูุซุงุช ูููุณุชูุฏุน

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ูููุงุฌูุฉ ุงูุฃูุงููุฉ:
1. ุชุญุฏูุซ ุงูููุฏ ูุงุณุชุฎุฏุงู `/api/v1/feed` ุจุฏูุงู ูู `/api/v1/posts`
2. ุงูุชุนุงูู ูุน `itemType` ูุนุฑุถ ุฃููุงุน ุงููุญุชูู ุงููุฎุชููุฉ
3. ุชุทุจูู ุงูุชูุฑูุฑ ุงููุงููุงุฆู ุจุงุณุชุฎุฏุงู pagination

### ููุฎุงุฏู (ุงุฎุชูุงุฑู):
1. ูุฑุงูุจุฉ ุงูุฃุฏุงุก ูุงูุชุญูููุงุช
2. ุชุนุฏูู ุงููุณุจ ุฅุฐุง ูุฒู ุงูุฃูุฑ
3. ุฅุถุงูุฉ cache ูููุชุงุฆุฌ (Redis)
4. ุชุญุณูู ุงูุงุณุชุนูุงูุงุช ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงูุญููููุฉ

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 31 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ**: โ ููุชูู ููุฑููุน ูููุณุชูุฏุน  
**Commit**: e56cf2c
