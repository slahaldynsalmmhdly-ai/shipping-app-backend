# ุชุญุฏูุซ ูุธุงู Feed - ูุธุงู ูุดุงุจู ูููุณุจูู

## ๐ฏ ุงููุฏู
ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูู ุฎูุงู:
- ุนุฑุถ ูุญุชูู ูุชููุน ูู ููุดูุฑุงุช ูุฅุนูุงูุงุช
- ุชูููู ูุณุจุฉ ุธููุฑ ููุดูุฑุงุช ุงููุชุงุจูุนูู ุฅูู 15% ููุท
- ุฅุฒุงูุฉ ุงูุงุฑุชุจุงู ุงููุงุชุฌ ุนู ุงูุฎูุท ุงูุนุดูุงุฆู
- ุชุทุจูู ุฎูุงุฑุฒููุฉ ุฐููุฉ ูุดุงุจูุฉ ูููุณุจูู

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. Feed ููุญุฏ
- ุฏูุฌ ุงูููุดูุฑุงุช (Posts)
- ุฏูุฌ ุฅุนูุงูุงุช ุงูุดุญู (ShipmentAds)
- ุฏูุฌ ุฅุนูุงูุงุช ุงูุดุงุญูุงุช ุงููุงุฑุบุฉ (EmptyTruckAds)

### 2. ุฎูุงุฑุฒููุฉ ุฐููุฉ
- **ูุธุงู ุงูููุงุท**: ูุนุชูุฏ ุนูู ุงูููุช (30%) + ุงูุชูุงุนู (40%) + ุงูุนูุงูุฉ (30%)
- **ูุณุจุฉ ุงููุชุงุจูุนูู**: 15% ููุท ูู ุงููุชุงุจูุนููุ 85% ูู ุงูุขุฎุฑูู
- **ุฎูุท ุซุงุจุช**: ููุณ ุงูุชุฑุชูุจ ุนูุฏ ูู ุชุญุฏูุซ (ูุง ููุฌุฏ ุงุฑุชุจุงู)

### 3. Pagination ูุญุณูู
- ุฏุนู ุงูุชูุฑูุฑ ุงููุงููุงุฆู
- ูุนูููุงุช ูุงุถุญุฉ ุนู ุงูุตูุญุงุช
- ุฃุฏุงุก ูุญุณูู

## ๐ ุงููููุงุช ุงููุถุงูุฉ

```
routes/
  โโโ feedRoutes.js          # ุงูู endpoint ุงูุฌุฏูุฏ ููู feed ุงูููุญุฏ

ANALYSIS.md                  # ุชุญููู ุงููุดููุฉ ูุงูุญู
FEED_UPDATE_DOCUMENTATION.md # ุชูุซูู ูุงูู ููุชุญุฏูุซุงุช
FEED_UPDATE_README.md        # ูุฐุง ุงูููู
```

## ๐ง ุงูุชุนุฏููุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

### `server.js`
```javascript
// ุชู ุฅุถุงูุฉ:
const feedRoutes = require("./routes/feedRoutes");
app.use("/api/v1/feed", feedRoutes);
```

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูู Endpoint ุงูุฌุฏูุฏ
```
GET /api/v1/feed?page=1&limit=20
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ
```json
{
  "items": [
    {
      "_id": "...",
      "itemType": "post",
      "user": { ... },
      "text": "...",
      "createdAt": "..."
    },
    {
      "_id": "...",
      "itemType": "shipmentAd",
      "user": { ... },
      "pickupLocation": "...",
      "createdAt": "..."
    },
    {
      "_id": "...",
      "itemType": "emptyTruckAd",
      "user": { ... },
      "currentLocation": "...",
      "createdAt": "..."
    }
  ],
  "pagination": {
    "currentPage": 1,
    "totalItems": 45,
    "totalPages": 3,
    "itemsPerPage": 20,
    "hasMore": true
  }
}
```

## ๐จ ุงูุชูุงูู ูุน ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### React/React Native ูุซุงู:
```javascript
import { useState, useEffect } from 'react';

function Feed() {
  const [items, setItems] = useState([]);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);

  useEffect(() => {
    loadFeed();
  }, [page]);

  const loadFeed = async () => {
    const response = await fetch(
      `/api/v1/feed?page=${page}&limit=20`,
      {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      }
    );
    const data = await response.json();
    
    setItems(prev => [...prev, ...data.items]);
    setHasMore(data.pagination.hasMore);
  };

  const renderItem = (item) => {
    switch(item.itemType) {
      case 'post':
        return <PostCard post={item} />;
      case 'shipmentAd':
        return <ShipmentAdCard ad={item} />;
      case 'emptyTruckAd':
        return <EmptyTruckAdCard ad={item} />;
      default:
        return null;
    }
  };

  return (
    <div>
      {items.map(item => (
        <div key={item._id}>
          {renderItem(item)}
        </div>
      ))}
      {hasMore && (
        <button onClick={() => setPage(p => p + 1)}>
          ุชุญููู ุงููุฒูุฏ
        </button>
      )}
    </div>
  );
}
```

## ๐ ุงูุฅุญุตุงุฆูุงุช (ููุชุทููุฑ)

```
GET /api/v1/feed/stats
```

ูุนุฑุถ:
- ุนุฏุฏ ุงูููุดูุฑุงุช ุงูุฅุฌูุงูู
- ุนุฏุฏ ุฅุนูุงูุงุช ุงูุดุญู
- ุนุฏุฏ ุฅุนูุงูุงุช ุงูุดุงุญูุงุช ุงููุงุฑุบุฉ
- ุนุฏุฏ ุงููุชุงุจูุนูู

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุงุจูุฉ ููุชุนุฏูู

ูู ููู `feedRoutes.js`ุ ููููู ุชุนุฏูู:

### ูุณุจุฉ ุงููุชุงุจูุนูู
```javascript
const followingPercentage = 0.15; // 15%
// ูููู ุชุบููุฑูุง ุฅูู 0.20 ูู 20% ูุซูุงู
```

### ุฃูุฒุงู ุงูููุงุท
```javascript
const finalScore = (
  (timeScore * 0.3) +      // ูุฒู ุงูููุช
  (engagementScore * 0.4) + // ูุฒู ุงูุชูุงุนู
  (relationshipScore * 0.3) // ูุฒู ุงูุนูุงูุฉ
);
```

### ุญุฏ ุงูุฎูุท
```javascript
// ุฎูุท ูู ูุฌููุนุงุช ูู 5
for (let i = 0; i < finalItems.length; i += 5) {
  // ูููู ุชุบููุฑ 5 ุฅูู 3 ุฃู 7 ุญุณุจ ุงูุญุงุฌุฉ
}
```

## ๐ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุฃุณุงุณู
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/v1/feed?page=1&limit=10
```

### 2. ุงุฎุชุจุงุฑ ุงูุฅุญุตุงุฆูุงุช
```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/v1/feed/stats
```

### 3. ุงุฎุชุจุงุฑ Pagination
```bash
# ุงูุตูุญุฉ ุงูุฃููู
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/v1/feed?page=1&limit=5

# ุงูุตูุญุฉ ุงูุซุงููุฉ
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:5000/api/v1/feed?page=2&limit=5
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุฃู ุนูุงุตุฑ
**ุงูุญู**: ุชุฃูุฏ ูู:
- ูุฌูุฏ ูุญุชูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุตุญุฉ ุงูู token
- ุฃู ุงูุญูู `isPublished` = true ุฃู ุบูุฑ ููุฌูุฏ

### ุงููุดููุฉ: ุฌููุน ุงูุนูุงุตุฑ ูู ุงููุชุงุจูุนูู
**ุงูุญู**: ุชุฃูุฏ ูู:
- ูุฌูุฏ ูุญุชูู ูู ูุณุชุฎุฏููู ุขุฎุฑูู
- ุฃู ูุณุจุฉ ุงููุชุงุจูุนูู 15% ุชุนูู ุจุดูู ุตุญูุญ

### ุงููุดููุฉ: ุงูุชุฑุชูุจ ูุชุบูุฑ ุนูุฏ ุงูุชุญุฏูุซ
**ุงูุญู**: 
- ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ููุณ ุงูู token (ููุณ ุงููุณุชุฎุฏู)
- ุฑุงุฌุน ุฎูุงุฑุฒููุฉ ุงูู seeded shuffle

## ๐ ุงูุฃุฏุงุก

### ุงูุชุญุณููุงุช ุงููุทุจูุฉ:
- โ ุงุณุชุฎุฏุงู `.lean()` ูุชูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ
- โ ุญุฏ ุฃูุตู 100 ุนูุตุฑ ูู ุงูุฐุงูุฑุฉ
- โ Pagination ูุนุงู
- โ ุงุณุชุนูุงูุงุช ูุญุณููุฉ

### ุชูุตูุงุช ููุฅูุชุงุฌ:
1. ุฅุถุงูุฉ Redis cache ูููุชุงุฆุฌ
2. ุงุณุชุฎุฏุงู indexes ุนูู ุญููู ุงูุจุญุซ
3. ุชุทุจูู rate limiting
4. ูุฑุงูุจุฉ ุงูุฃุฏุงุก

## ๐ ุงููุฌุฑุฉ ูู ุงูู Endpoint ุงููุฏูู

### ูุจู:
```javascript
// ุงุณุชุฏุนุงุก ูููุตู ููู ููุน
const posts = await fetch('/api/v1/posts');
const shipmentAds = await fetch('/api/v1/shipmentads');
const emptyTruckAds = await fetch('/api/v1/emptytruckads');

// ุฏูุฌ ูุฏูู
const allItems = [...posts, ...shipmentAds, ...emptyTruckAds];
```

### ุจุนุฏ:
```javascript
// ุงุณุชุฏุนุงุก ูุงุญุฏ ููุท
const feed = await fetch('/api/v1/feed?page=1&limit=20');
// ุฌููุน ุงูุนูุงุตุฑ ูุฏูุฌุฉ ููุฑุชุจุฉ
```

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูู endpoints ุงููุฏููุฉ ูุง ุฒุงูุช ุชุนูู** - ูู ูุชู ุญุฐููุง ููุชูุงูู ูุน ุงูุฅุตุฏุงุฑุงุช ุงููุฏููุฉ
2. **ูููุตุญ ุจุดุฏุฉ** ุจุงุณุชุฎุฏุงู `/api/v1/feed` ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
3. **ุงูุฎูุท ุงูุซุงุจุช** ูุถูู ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ุจุฏูู ุงุฑุชุจุงู
4. **ุงููุณุจ ูุงุจูุฉ ููุชุนุฏูู** ุญุณุจ ุงุญุชูุงุฌุงุช ุงูุชุทุจูู

## ๐ ุงููุชูุฌุฉ

ุชู ุญู ุฌููุน ุงููุดุงูู:
- โ ูุง ููุฌุฏ ุงุฑุชุจุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
- โ ูุณุจุฉ 15% ููุท ูู ููุดูุฑุงุช ุงููุชุงุจูุนูู
- โ ูุญุชูู ูุชููุน ูู ููุดูุฑุงุช ูุฅุนูุงูุงุช
- โ ุฎูุงุฑุฒููุฉ ุฐููุฉ ูุดุงุจูุฉ ูููุณุจูู
- โ ุฃุฏุงุก ูุญุณูู ูุน pagination

## ๐ ุงูุฏุนู

ููุฃุณุฆูุฉ ุฃู ุงููุดุงููุ ุฑุงุฌุน:
- `FEED_UPDATE_DOCUMENTATION.md` - ุชูุซูู ูุงูู
- `ANALYSIS.md` - ุชุญููู ุงููุดููุฉ ูุงูุญู
- logs ุงูุฎุงุฏู ููุฃุฎุทุงุก

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 31 ุฃูุชูุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0.0
