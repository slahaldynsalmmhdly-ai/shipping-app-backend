# ุชูุซูู ููุฒุฉ ุงูููุชุฑุฉ ุญุณุจ ุงููููุน (ุงูุฏููุฉ ูุงููุฏููุฉ)

## โ ุญุงูุฉ ุงูููุฒุฉ: **ุฌุงูุฒุฉ ูููุนูุฉ**

ุชุงุฑูุฎ ุงูุชุญูู: 18 ููููุจุฑ 2025

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุงููุงุฌูุฉ ุงูุฎูููุฉ ุชุฏุนู ุจุงููุนู ููุชุฑุฉ ุงูููุดูุฑุงุช ุญุณุจ ุงูุฏููุฉ ูุงููุฏููุฉ ูู ุฎูุงู query parameters.

---

## ๐ง ุงูุชูุงุตูู ุงูุชูููุฉ

### 1. ุงุณุชูุจุงู Parameters

**ุงูููู:** `routes/feedRoutes.js`  
**ุงูุฃุณุทุฑ:** 31-32

```javascript
const filterCountry = req.query.country || null;
const filterCity = req.query.city || null;
```

โ ุงูููุฏ ูุณุชูุจู `country` ู `city` ูู query parameters

---

### 2. ูุนุงูุฌุฉ ุงูููู

**ุงูุฃุณุทุฑ:** 36-44

```javascript
if (filterCountry !== null) {
  // ุงููุณุชุฎุฏู ุงุฎุชุงุฑ ููุชุฑ ูุญุฏุฏ
  userCountry = filterCountry === '' ? null : filterCountry;
  userCity = filterCity === '' ? null : filterCity;
} else {
  // ุงุณุชุฎุฏู ูููุน ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  userCountry = currentUser?.country || null;
  userCity = currentUser?.city || null;
}
```

**ุงูููุทู:**
- ุฅุฐุง ุชู ุฅุฑุณุงู `country` ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ โ ูุณุชุฎุฏูู
- ุฅุฐุง ูู ูุชู ุฅุฑุณุงู โ ูุณุชุฎุฏู ูููุน ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ููุณ ุงูุดูุก ููู `city`

---

### 3. ุจูุงุก ุงูููุชุฑ

**ุงูุฃุณุทุฑ:** 46-84

ูุชู ุจูุงุก ููุชุฑ ุฏููุงูููู ุญุณุจ ุงูุญุงูุงุช ุงูุชุงููุฉ:

#### ุญุงูุฉ 1: ุงููุณุชุฎุฏู ุจุฏูู ุฏููุฉ
```javascript
if (userCountry === null) {
  locationFilter = {
    $or: [
      { scope: 'global' },
      { scope: { $exists: false } },
      { scope: null },
      { scope: 'local' }
    ]
  };
}
```
**ุงููุชูุฌุฉ:** ูุฑู ุฌููุน ุงูููุดูุฑุงุช (ุนุงูููุฉ ููุญููุฉ)

#### ุญุงูุฉ 2: ุงููุณุชุฎุฏู ูุฏูู ุฏููุฉ
```javascript
locationFilter = {
  $or: [
    { scope: 'global' }, // ุงูููุดูุฑุงุช ุงูุนุงูููุฉ
    { scope: { $exists: false } },
    { scope: null },
    // ุงูููุดูุฑุงุช ุงููุญููุฉ ุญุณุจ ุงููููุน
    {
      $and: [
        { scope: 'local' },
        {
          $or: [
            // ููุดูุฑุงุช ุจููุณ ุงููุฏููุฉ
            { $and: [{ city: { $exists: true, $ne: null } }, { city: userCity }] },
            // ููุดูุฑุงุช ุจููุณ ุงูุฏููุฉ (ุจุฏูู ูุฏููุฉ ูุญุฏุฏุฉ)
            { $and: [{ city: { $in: [null, undefined] } }, { country: userCountry }] },
            // ููุดูุฑุงุช ูุฏููุฉ ุจุฏูู ูููุน
            { $and: [{ country: { $in: [null, undefined] } }, { city: { $in: [null, undefined] } }] }
          ]
        }
      ]
    }
  ]
};
```

**ุงููุชูุฌุฉ:** ูุฑู ุงูููุดูุฑุงุช ุงูุนุงูููุฉ + ุงูููุดูุฑุงุช ุงููุญููุฉ ูู ููุณ ุงููููุน

---

### 4. ุชุทุจูู ุงูููุชุฑ

**ุงูุฃุณุทุฑ:** 86-114

```javascript
const posts = await Post.find({
  $and: [
    { $or: [{ isPublished: true }, { isPublished: { $exists: false } }] },
    { hiddenFromHomeFeedFor: { $ne: req.user.id } },
    { user: { $ne: req.user.id } },
    { $or: [
      { publishScope: { $exists: false } },
      { publishScope: null },
      { publishScope: 'home_and_category' }
    ] },
    locationFilter // โ ุงูููุชุฑ ููุทุจู ููุง
  ]
})
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

### ูุซุงู 1: ููุชุฑุฉ ุญุณุจ ุงูุฏููุฉ ููุท
```http
GET /api/v1/feed?page=1&limit=10&country=ุงูุณุนูุฏูุฉ
```

**ุงููุชูุฌุฉ:**
- ุงูููุดูุฑุงุช ุงูุนุงูููุฉ (scope: 'global')
- ุงูููุดูุฑุงุช ุงููุญููุฉ ูู ุงูุณุนูุฏูุฉ

---

### ูุซุงู 2: ููุชุฑุฉ ุญุณุจ ุงูุฏููุฉ ูุงููุฏููุฉ
```http
GET /api/v1/feed?page=1&limit=10&country=ุงูุณุนูุฏูุฉ&city=ุงูุฑูุงุถ
```

**ุงููุชูุฌุฉ:**
- ุงูููุดูุฑุงุช ุงูุนุงูููุฉ (scope: 'global')
- ุงูููุดูุฑุงุช ุงููุญููุฉ ูู ุงูุฑูุงุถ
- ุงูููุดูุฑุงุช ุงููุญููุฉ ูู ุงูุณุนูุฏูุฉ (ุจุฏูู ูุฏููุฉ ูุญุฏุฏุฉ)

---

### ูุซุงู 3: ุจุฏูู ููุชุฑ (ุงุณุชุฎุฏุงู ูููุน ุงููุณุชุฎุฏู)
```http
GET /api/v1/feed?page=1&limit=10
```

**ุงููุชูุฌุฉ:**
- ูุณุชุฎุฏู `country` ู `city` ูู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

### ูุซุงู 4: ุฅูุบุงุก ุงูููุชุฑ (ุนุฑุถ ุงููู)
```http
GET /api/v1/feed?page=1&limit=10&country=&city=
```

**ุงููุชูุฌุฉ:**
- ูุนุงูู ูุฃู ุงููุณุชุฎุฏู ุจุฏูู ูููุน
- ูุนุฑุถ ุฌููุน ุงูููุดูุฑุงุช

---

## ๐ ุฃููุงุน ุงูููุดูุฑุงุช ุงููุฏุนููุฉ

| **ุงูููุน** | **ุงูููุชุฑุฉ** | **ุงูููุงุญุธุงุช** |
|---|---|---|
| Post | โ ูุฏุนููุฉ | ูุทุจู locationFilter |
| ShipmentAd | โ ุบูุฑ ูุฏุนููุฉ | ูุง ูุทุจู ุงูููุชุฑ ุญุงููุงู |
| EmptyTruckAd | โ ุบูุฑ ูุฏุนููุฉ | ูุง ูุทุจู ุงูููุชุฑ ุญุงููุงู |

**ููุงุญุธุฉ:** ุฅุนูุงูุงุช ุงูุดุญู ูุงูุดุงุญูุงุช ุงููุงุฑุบุฉ ูุง ุชูููุชุฑ ุญุณุจ ุงููููุน ุญุงููุงู. ุฅุฐุง ููุช ุชุฑูุฏ ุฅุถุงูุฉ ุงูููุชุฑุฉ ููุงุ ูููู ุชุญุฏูุซ ุงูููุฏ.

---

## ๐ ููุงุญุธุงุช ูููุฉ

### 1. ุงูููุดูุฑุงุช ุจุฏูู scope
ุงูููุดูุฑุงุช ุงููุฏููุฉ ุงูุชู ูุง ุชุญุชูู ุนูู ุญูู `scope` ุชูุนุงูู ูููุดูุฑุงุช ุนุงูููุฉ ูุชุธูุฑ ููุฌููุน.

### 2. ุงูููุดูุฑุงุช ุจุฏูู ูููุน
ุงูููุดูุฑุงุช ุงููุญููุฉ (scope: 'local') ุงูุชู ูุง ุชุญุชูู ุนูู `country` ู `city` ุชุธูุฑ ููุฌููุน.

### 3. encoding ุงูููู ุงูุนุฑุจูุฉ
ูุฌุจ ุงุณุชุฎุฏุงู `encodeURIComponent` ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:
```javascript
const country = 'ุงูุณุนูุฏูุฉ';
const url = `/api/v1/feed?country=${encodeURIComponent(country)}`;
```

---

## โ ุงูุฎูุงุตุฉ

**ุงููุงุฌูุฉ ุงูุฎูููุฉ ุฌุงูุฒุฉ ุชูุงูุงู ููุง ุชุญุชุงุฌ ุฃู ุชุนุฏููุงุช!**

- โ ูุณุชูุจู `req.query.country` ู `req.query.city`
- โ ูุณุชุฎุฏูููุง ูู ููุชุฑุฉ ุงูููุดูุฑุงุช
- โ ูุฏุนู ุงูููุชุฑุฉ ุงูุฏููุงููููุฉ
- โ ูุฏุนู ุงุณุชุฎุฏุงู ูููุน ุงููุณุชุฎุฏู ุชููุงุฆูุงู
- โ ูุฏุนู ุฅูุบุงุก ุงูููุชุฑ

**ุงููุทููุจ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:**
- ุฅุฑุณุงู `country` ู `city` ูู query parameters
- ุงุณุชุฎุฏุงู `encodeURIComponent` ููููู ุงูุนุฑุจูุฉ

---

**ุชุงุฑูุฎ ุงูุชูุซูู:** 18 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู  
**ุขุฎุฑ ุชุญุฏูุซ:** ุงูุณุทูุฑ 31-84 ูู feedRoutes.js
